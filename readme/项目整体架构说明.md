# 图书管理系统



# 步骤1：项目整体架构设计

## 一、项目需求梳理（确认核心功能）

先明确你的图书借阅和在线阅读管理系统主要有哪些“核心功能”——你前面提到的用户管理、图书管理、借阅、在线阅读、后台管理，基本就是第一步需求梳理。

### 示例需求列表

1. 用户注册/登录/权限管理
2. 图书信息管理（增删改查、分类、搜索、封面上传）
3. 借阅管理（借书、还书、借阅历史、逾期提醒）
4. 电子书上传/在线阅读（PDF/图片预览）
5. 管理后台（管理用户、图书、借阅、系统设置）

## 二、系统架构草图（分层设计）

一个标准的企业级 .NET Core MVC 项目通常采用**三层或四层架构**，保证“高内聚、低耦合”，便于后期扩展和测试。

### 推荐分层架构（经典三层+前端）



## 三、【Visual Studio 2022】第一步：新建 .NET Core Web API 项目

### 1. 新建项目

1. 打开 Visual Studio 2022，点击“创建新项目”。
2. 搜索并选择 **ASP.NET Core Web API**，点击“下一步”。
3. 输入项目名称（如 `BookLibraryAPI`），选择存储路径，点击“创建”。
4. 在“其他信息”页：
   - .NET 版本：选择 **.NET 6.0** 或 **.NET 8.0**
   - “启用OpenAPI支持”请勾选（方便Swagger调试）
   - 认证类型：**无认证**（后续可以加）
   - 其余保持默认，点击“创建”。

2、你需要做两步：

### 2. 安装 NuGet 包

在 Visual Studio 2022 中：

- 右键你的项目 → “管理 NuGet 包”
- 搜索并安装 **Swashbuckle.AspNetCore**

3、直接改回“经典 Swagger 配置”，一定能看到 `/swagger/index.html`

 `Program.cs` 修改为如下内容：

```c#
//创建一个 WebApplicationBuilder 实例，开始构建 Web 应用
//args 是命令行参数，允许你通过命令行/配置文件影响应用行为。
//这个 builder 用于注册各种服务、配置管道等。

var builder = WebApplication.CreateBuilder(args);


//向依赖注入容器中注册“控制器”服务（即 API Controller）。
//让应用支持 MVC/Web API 路由、参数绑定、模型验证等功能。
// Add services to the container.

builder.Services.AddControllers();

//注册“终结点API浏览器”，用于生成 OpenAPI/Swagger 文档所需的 API 元数据。
//没有这句，SwaggerGen 会找不到你有哪些API接口，文档会不全或报错。

builder.Services.AddEndpointsApiExplorer();

//注册 Swagger 生成服务，让你后续可以自动生成 API 文档和可视化页面（Swagger UI）。
//这是 API 开发和调试的利器，也是前后端联调的重要工具。

builder.Services.AddSwaggerGen();


//根据 builder 的配置生成真正的 WebApplication 实例。
//这里可以理解为“应用程序正式装配完毕，准备启动”。

var app = builder.Build();

//配置“中间件管道”。
//判断当前环境是否为开发环境（Development），只有在开发环境下才启用Swagger和Swagger UI（避免生产环境暴露接口文档）。
//app.UseSwagger()：启用 Swagger 生成 OpenAPI JSON 文档。
//app.UseSwaggerUI()：启用 Swagger 可视化网页（UI）。
// Configure the HTTP request pipeline.

if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}

//启用 HTTPS 重定向，把所有 HTTP 请求自动跳转到 HTTPS，增强安全性。
//生产环境建议始终开启。

app.UseHttpsRedirection();

//启用授权中间件。
//用于校验用户权限（比如 [Authorize] 特性修饰的API），没有它相关鉴权会失效。
//注意：只是授权，不是认证，后续你加身份验证（如JWT）时会用到。
app.UseAuthorization();

//映射 API 路由，把 Controller 里的所有 action 方法注册成 HTTP 路由（如 /api/books）。
//没有这句，所有 Controller API 都访问不到。
app.MapControllers();

//启动整个 Web 应用，开始监听端口，正式对外服务。
//这是主入口，应用程序会一直阻塞在这里直到关闭。

app.Run();


//总结归纳
//builder 阶段：注册各种服务（Controller、Swagger、依赖注入等）。
//app 阶段：装配、配置请求管道（中间件）、设置API路由、最终启动应用。

```

### 3. **再次运行/调试项目**

- 在VS里点绿色启动按钮（或F5）。
- 看输出窗口，**确认有 “Now listening on https://localhost:xxxx”** 这样的字样。



# 四、数据建模（以“图书”为例）

我们先为**“图书”**建一个最基础的数据模型（Book），然后用 Entity Framework Core 让它对应数据库表。

## 1. 创建 Book 实体模型

在项目根目录下的 `Models` 文件夹内（没有就新建），添加 `Book.cs`：

```
using System.ComponentModel.DataAnnotations;

namespace BookLibraryAPI.Models
{
    /// <summary>
    /// 图书实体，对应数据库中的“图书”表
    /// </summary>
    public class Book
    {
        [Key] // 主键
        public int Id { get; set; }

        [Required] // 必填
        [MaxLength(100)] // 最大长度100
        public string Title { get; set; } = string.Empty;

        [MaxLength(50)]
        public string? Author { get; set; }

        [MaxLength(50)]
        public string? Category { get; set; }

        [MaxLength(500)]
        public string? Description { get; set; }

        public string? CoverUrl { get; set; } // 封面图片链接

        public bool IsAvailable { get; set; } = true; // 是否可借

        public bool CanReadOnline { get; set; } = false; // 新增：是否可在线阅读
    }
}

    
```

## 2. 配置数据库上下文（DbContext）

在项目根目录下新建 `Data` 文件夹，添加 `AppDbContext.cs`：

```


using BookLibraryAPI.Models;
using Microsoft.EntityFrameworkCore;
using System.Collections.Generic;

namespace BookLibraryAPI.Data
{
    /// <summary>
    ///  配置数据库上下文（DbContext）
    /// 应用程序的数据库上下文，包含所有实体表
    ///  安装EntityFrameworkCore
    /// </summary>
    public class AppDbContext : DbContext
    {
        public AppDbContext(DbContextOptions<AppDbContext> options) : base(options) { }

        // DbSet<Book> 就是对应数据库里的“Books”表
        public DbSet<Book> Books { get; set; }
    }
}



```



## 3. 注册 DbContext 并配置数据库连接

### 步骤3.1

**打开 `Program.cs`，添加EF Core依赖与数据库连接：**

安装Microsoft.EntityFrameworkCore.sqlserver

```c#
using BookLibraryAPI.Data; // 引入DbContext命名空间
using Microsoft.EntityFrameworkCore;

// 在 builder.Services.AddControllers(); 下面加入：
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));

```

### 步骤3.2

**编辑 `appsettings.json`，添加数据库连接字符串：**

```json

"ConnectionStrings": {
  "DefaultConnection": "Server=scipio\\MSSQL2026;Database=BookLibraryDb;User Id=sa;Password=13478740;TrustServerCertificate=True;"
}

```